{% extends "base.html" %}

{% block title %}K·∫øt qu·∫£ b√†i n·ªôp{% endblock %}

{% block content %}
<div class="content">
  <div class="container">
    <h1 style="text-align: center; background: linear-gradient(135deg, var(--primary-color), #7c3aed); color: white; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 2rem; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2); font-weight: 700; font-size: 1.5rem;">
      üìÑ K·∫øt qu·∫£ b√†i n·ªôp
    </h1>

    <section class="submission-info" aria-label="Th√¥ng tin b√†i n·ªôp">
      <div class="info-group">
        <div class="info-label">
          <i class="fas fa-user"></i>
          Ng∆∞·ªùi n·ªôp
        </div>
        <div class="info-value">{{ submission.user.username }}</div>
      </div>

      <div class="info-group">
        <div class="info-label">
          <i class="fas fa-book"></i>
          T√™n ƒë·ªÅ b√†i
        </div>
        <div class="info-value">{{ submission.problem.title }}</div>
      </div>

      <div class="info-group">
        <div class="info-label">
          <i class="fas fa-clock"></i>
          Th·ªùi gian n·ªôp
        </div>
        <div class="info-value">{{ submission.submitted_at|date:"H:i d/m/Y" }}</div>
      </div>

      {% if submission.result %}
      <div class="info-group">
        <div class="info-label">
          <i class="fas fa-robot"></i>
          K·∫øt qu·∫£ ch·∫•m (AI)
        </div>
        <div class="info-value">
          <span class="status-badge status-{% if 'Accepted' in submission.result %}accepted{% elif 'Wrong' in submission.result %}wrong{% else %}pending{% endif %}">
            {{ submission.result }}
          </span>
        </div>
      </div>
      {% endif %}

      {% if submission.score %}
      <div class="info-group">
        <div class="info-label">
          <i class="fas fa-chart-bar"></i>
          ƒêi·ªÉm s·ªë
        </div>
        <div class="info-value score">{{ submission.score }}/10</div>
      </div>
      {% endif %}
    </section>

    <section aria-label="N·ªôi dung b√†i l√†m v√† nh·∫≠n x√©t">
      <h2 style="font-size: 1.25rem; font-weight: 600; color: var(--dark-color); margin: 2rem 0 1rem; padding: 0.75rem 1rem; background: var(--light-color); border-radius: 0.5rem; border-left: 4px solid var(--primary-color); display: flex; align-items: center; gap: 0.75rem;">
        <i class="fas fa-code" style="color: var(--primary-color); font-size: 1.1rem; width: 1.5rem;"></i>
        N·ªôi dung b√†i l√†m
      </h2>

      <div class="code-section">
        <div class="code-wrapper" style="overflow: hidden; background: #1f2937; padding: 1rem; border-radius: 0.5rem; max-width: 100%; box-sizing: border-box;">
          <pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; overflow: hidden; background: transparent; color: #e5e7eb; font-family: 'Fira Code', 'JetBrains Mono', monospace; font-size: 0.875rem; line-height: 1.7;"><code class="code-content" style="display: block; white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word;">{{ submission.code }}</code></pre>
        </div>
      </div>

      {% if submission.comment %}
      <h2 style="font-size: 1.25rem; font-weight: 600; color: var(--dark-color); margin: 2rem 0 1rem; padding: 0.75rem 1rem; background: #f5f3ff; border-radius: 0.5rem; border-left: 4px solid #8B5CF6; display: flex; align-items: center; gap: 0.75rem;">
        <i class="fas fa-comment-alt" style="color: #8B5CF6; font-size: 1.1rem; width: 1.5rem;"></i>
        Nh·∫≠n x√©t c·ªßa AI
      </h2>
      <div class="card" style="background: #f8f7ff; border-left: 4px solid #8B5CF6; box-shadow: 0 4px 6px -1px rgba(139, 92, 246, 0.1); border-radius: 0.5rem; overflow: hidden;">
        <div class="card-body">
          {{ submission.comment|linebreaks }}
        </div>
      </div>
      {% endif %}

      <div class="action-buttons" style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: flex-start;">
        <a href="{% url 'problem_detail' submission.problem.id %}" class="btn btn-primary">
          <i class="fas fa-arrow-left"></i>
          <span>Quay l·∫°i ƒë·ªÅ b√†i</span>
        </a>
      </div>
    </section>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const copyBtn = document.querySelector('.copy-btn');
  if (copyBtn) {
    copyBtn.addEventListener('click', function() {
      const codeElement = document.querySelector('.code-content');
      const code = codeElement.textContent;
      navigator.clipboard.writeText(code).then(() => {
        const icon = this.querySelector('i');
        const text = this.querySelector('span');
        icon.classList.remove('fa-copy');
        icon.classList.add('fa-check');
        text.textContent = 'Copied!';
        this.style.background = 'rgba(5, 150, 105, 0.2)';
        this.style.color = '#059669';
        setTimeout(() => {
          icon.classList.remove('fa-check');
          icon.classList.add('fa-copy');
          text.textContent = 'Copy';
          this.style.background = '';
          this.style.color = '';
        }, 2000);
      }).catch(err => {
        console.error('L·ªói khi copy:', err);
      });
    });
  }
});

function copyCode() {
  const codeElement = document.querySelector('.code-content');
  if (codeElement) {
    const code = codeElement.textContent;
    navigator.clipboard.writeText(code).then(() => {
      const btn = document.querySelector('.copy-btn');
      if (btn) {
        const icon = btn.querySelector('i');
        const text = btn.querySelector('span');
        icon.classList.remove('fa-copy');
        icon.classList.add('fa-check');
        text.textContent = 'Copied!';
        btn.style.background = 'rgba(5, 150, 105, 0.2)';
        btn.style.color = '#059669';
        setTimeout(() => {
          icon.classList.remove('fa-check');
          icon.classList.add('fa-copy');
          text.textContent = 'Copy';
          btn.style.background = '';
          btn.style.color = '';
        }, 2000);
      }
    }).catch(err => {
      console.error('L·ªói khi copy:', err);
    });
  }
}
</script>

{% endblock %}