{% extends 'base.html' %}

{% block title %}üèÜ B·∫£ng x·∫øp h·∫°ng - {{ problem.title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
  <!-- Header -->
  <header class="relative mb-10 text-center">
    <div class="relative inline-block">
      <div class="w-20 h-20 bg-gradient-to-r from-amber-400 to-orange-500 rounded-2xl flex items-center justify-center text-white text-3xl transform rotate-12 transition-transform hover:rotate-0 hover:scale-110">
        <i class="fas fa-trophy"></i>
      </div>
      <div class="absolute -inset-2 bg-gradient-to-r from-amber-400 to-orange-500 rounded-2xl blur-lg opacity-40"></div>
    </div>
    <h1 class="mt-6 text-3xl font-bold text-white tracking-tight">B·∫£ng X·∫øp H·∫°ng</h1>
    <p class="mt-2 text-lg text-indigo-200">
      Nh·ªØng chi·∫øn binh xu·∫•t s·∫Øc nh·∫•t cho b√†i t·∫≠p: <strong class="font-semibold">{{ problem.title }}</strong>
    </p>
  </header>

  <!-- B·∫£ng x·∫øp h·∫°ng ho·∫∑c Tr·∫°ng th√°i r·ªóng -->
  {% if top_scores %}
    <div class="space-y-3">
      {% for row in top_scores %}
        {% comment %} Th√™m class ƒë·∫∑c bi·ªát cho top 3 {% endcomment %}
        {% with forloop.counter as rank %}
        <div
          class="
            ranking-item relative flex items-center p-4 rounded-xl shadow-lg
            transition-all duration-300 hover:shadow-2xl hover:scale-[1.02]
            {% if rank == 1 %} bg-gradient-to-r from-yellow-300 to-amber-400 border-2 border-yellow-500
            {% elif rank == 2 %} bg-gradient-to-r from-slate-200 to-gray-300 border-2 border-slate-400
            {% elif rank == 3 %} bg-gradient-to-r from-orange-300 to-amber-500 border-2 border-orange-500
            {% else %} bg-white/90 backdrop-blur-sm border border-gray-200 {% endif %}
            slide-in-item
          "
          style="--delay-index: {{ forloop.counter0 }};"
        >
          <!-- Huy hi·ªáu Rank -->
          <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center font-bold text-xl rounded-full mr-4
            {% if rank == 1 %} bg-yellow-500 text-white shadow-md
            {% elif rank == 2 %} bg-slate-400 text-white shadow-md
            {% elif rank == 3 %} bg-orange-500 text-white shadow-md
            {% else %} bg-indigo-100 text-indigo-600 {% endif %}
          ">
            {{ rank }}
          </div>

          <!-- Th√¥ng tin ng∆∞·ªùi d√πng -->
          <div class="flex-grow flex items-center">
            <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center font-semibold text-indigo-700 mr-4 uppercase shadow-inner">
                {{ row.user__username|first }}
            </div>
            <span class="font-semibold text-gray-800">{{ row.user__username }}</span>
          </div>

          <!-- ƒêi·ªÉm s·ªë -->
          <div class="flex-shrink-0 ml-4">
             <div class="px-4 py-2 rounded-lg text-center font-bold
                {% if row.best_score >= 8 %} bg-emerald-500/80 text-white
                {% elif row.best_score >= 5 %} bg-amber-500/80 text-white
                {% else %} bg-red-500/80 text-white {% endif %}
             ">
                <span class="text-lg">{{ row.best_score }}</span><span class="text-sm opacity-80">/10</span>
             </div>
          </div>

          <!-- V∆∞∆°ng mi·ªán cho top 1 -->
          {% if rank == 1 %}
          <div class="absolute -top-4 -left-4 text-3xl text-yellow-500 transform -rotate-12">
            <i class="fas fa-crown"></i>
          </div>
          {% endif %}
        </div>
        {% endwith %}
      {% endfor %}
    </div>

  {% else %}
    <!-- Tr·∫°ng th√°i r·ªóng -->
    <div class="text-center py-16 px-6 bg-white/80 backdrop-blur-md rounded-2xl shadow-lg">
        <div class="relative inline-block mb-8">
            <div class="w-24 h-24 mx-auto rounded-2xl bg-gradient-to-r from-sky-400 to-cyan-500 flex items-center justify-center transform -rotate-6">
                <i class="fas fa-satellite-dish text-4xl text-white animate-pulse"></i>
            </div>
            <div class="absolute inset-0 bg-gradient-to-r from-sky-400 to-cyan-500 rounded-2xl blur-xl opacity-30"></div>
        </div>
        <h2 class="text-3xl font-bold text-slate-800">
            B·∫£ng x·∫øp h·∫°ng ƒëang ch·ªù ƒë·ª£i...
        </h2>
        <p class="mt-4 mb-8 text-slate-600 max-w-md mx-auto">
            Hi·ªán ch∆∞a c√≥ b√†i n·ªôp n√†o ƒë∆∞·ª£c ghi nh·∫≠n. H√£y l√† ng∆∞·ªùi ti√™n phong v√† ghi t√™n m√¨nh v√†o l·ªãch s·ª≠!
        </p>
        <a href="{% url 'problem_detail' problem.id %}"
            class="btn btn-primary inline-flex items-center px-8 py-4 text-lg group">
            <i class="fas fa-rocket mr-3 transition-transform group-hover:rotate-12"></i>
            Chinh ph·ª•c th·ª≠ th√°ch
        </a>
    </div>
  {% endif %}

  <!-- N√∫t quay l·∫°i -->
  <div class="mt-12 text-center">
      <a href="{% url 'problem_detail' problem.id %}" class="inline-flex items-center px-6 py-3 bg-white/20 text-white rounded-xl hover:bg-white/30 backdrop-blur-sm transition-colors duration-300 font-medium">
          <i class="fas fa-chevron-left mr-2 text-sm"></i>
          Quay l·∫°i ƒë·ªÅ b√†i
      </a>
  </div>

</div>

<style>
  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .slide-in-item {
    animation: slideInUp 0.5s ease-out forwards;
    animation-delay: calc(var(--delay-index) * 100ms);
    opacity: 0; /* B·∫Øt ƒë·∫ßu ·∫©n */
  }
</style>
{% endblock %}
